/*! Reef v7.6.0 | (c) 2020 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
"use strict";var e,t=["checked","selected","value"],n=!1,r=function(e){return Array.prototype.slice.call(e)},a=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},o=function(e){if(n)throw new Error(e)},i=function(e,t){var n=a(e);if("object"===n){var r={};for(var o in e)e.hasOwnProperty(o)&&(r[o]=i(e[o],t));return r}return"array"===n?e.map((function(e){return i(e,t)})):"string"!==n||t?e:e.replace(/[^\w-_. ]/gi,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/javascript:/gi,"")},c=function(e){e.debounce&&window.cancelAnimationFrame(e.debounce),e.debounce=window.requestAnimationFrame((function(){e.render()}))},u=function(e){return{get:function(t,n){return["object","array"].indexOf(a(t[n]))>-1?new Proxy(t[n],u(e)):t[n]},set:function(t,n,r){return t[n]===r||(t[n]=r,c(e)),!0}}},l=function(e,t){var n=e.filter(t);return n.length<1?null:n[0]},s=function(e,t){if(!(e||t&&t.lagoon))return o("You did not provide an element to make into a component.");if(!t||!t.template&&!t.lagoon)return o("You did not provide a template for this component.");var n=this,l=function(e,t){return e.setters?e.store?null:e.data:e.data&&!e.store?new Proxy(e.data,u(t)):null}(t,n),s=t.store,f=t.router,d=t.setters,h=t.getters;(n.debounce=null,Object.defineProperties(n,{elem:{value:e},template:{value:t.template},allowHTML:{value:t.allowHTML},lagoon:{value:t.lagoon},store:{value:s},attached:{value:[]},router:{value:f}}),Object.defineProperty(n,"data",{get:function(){return d?i(l,!0):l},set:function(e){return s||d||(l=new Proxy(e,u(n)),c(n)),!0}}),d&&!s&&Object.defineProperty(n,"do",{value:function(e){if(!d[e])return o("There is no setter with this name.");var t=r(arguments);t[0]=l,d[e].apply(n,t),c(n)}}),h&&!s&&Object.defineProperty(n,"get",{value:function(e){return h[e]?h[e](l):o("There is no getter with this name.")}}),f&&"addComponent"in f&&f.addComponent(n),s&&"attach"in s&&s.attach(n),t.attachTo)&&("array"===a(t.attachTo)?t.attachTo:[t.attachTo]).forEach((function(e){"attach"in e&&e.attach(n)}))};s.Store=function(e){return e.lagoon=!0,new s(null,e)};var f=function(e,t){t.forEach((function(t){e.style[t]=""}))},d=function(e,t){t.forEach((function(t){if("class"===t.att)e.className=t.value;else if("style"===t.att)!function(e,t){var n=function(e){return e.split(";").reduce((function(e,t){var n=t.indexOf(":");return n&&e.push({name:t.slice(0,n).trim(),value:t.slice(n+1).trim()}),e}),[])}(t),r=Array.prototype.filter.call(e.style,(function(t){return null===l(n,(function(n){return n.name===t&&n.value===e.style[t]}))}));f(e,r),function(e,t){t.forEach((function(t){e.style[t.name]=t.value}))}(e,n)}(e,t.value);else{if(t.att in e)try{e[t.att]=t.value,e[t.att]||0===e[t.att]||(e[t.att]=!0)}catch(e){}try{e.setAttribute(t.att,t.value)}catch(e){}}}))},h=function(e,t){t.forEach((function(t){if("class"===t.att)e.className="";else if("style"===t.att)f(e,r(e.style));else{if(t.att in e)try{e[t.att]=""}catch(e){}try{e.removeAttribute(t.att)}catch(e){}}}))},m=function(e,t){return{att:e,value:t}},p=function(e,n){if(1!==e.nodeType)return[];var r=function(e,n){return Array.prototype.reduce.call(e.attributes,(function(e,r){return!(t.indexOf(r.name)<0||n&&"selected"===r.name)||r.name.length>7&&"default"===r.name.slice(0,7)||e.push(m(r.name,r.value)),e}),[])}(e,n);return function(e,n,r){t.forEach((function(t){!e[t]&&0!==e[t]||r&&"option"===e.tagName.toLowerCase()&&"selected"===t||r&&"select"===e.tagName.toLowerCase()&&"value"===t||n.push(m(t,e[t]))}))}(e,r,n),r},v=function(e){return 3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase()},y=function(e){return e.childNodes&&e.childNodes.length>0?null:e.textContent},g=function(e){1===e.nodeType&&(Array.prototype.forEach.call(e.attributes,(function(t){t.name.length<8||"default"!==t.name.slice(0,7)||(d(e,[m(t.name.slice(7).toLowerCase(),t.value)]),h(e,[m(t.name,t.value)]))})),e.childNodes&&Array.prototype.forEach.call(e.childNodes,(function(e){g(e)})))},w=function(e,n,a){var o=r(n.childNodes),i=r(e.childNodes),c=o.length-i.length;if(c>0)for(;c>0;c--)o[o.length-c].parentNode.removeChild(o[o.length-c]);i.forEach((function(e,r){if(!o[r])return g(e),void n.appendChild(e.cloneNode(!0));if(v(e)===v(o[r])){if(function(e,n){var r=p(e,!0),a=p(n),o=a.filter((function(e){return!(t.indexOf(e.att)>-1)&&null===l(r,(function(t){return e.att===t.att}))})),i=r.filter((function(e){var t=l(a,(function(t){return e.att===t.att}));return null===t||t.value!==e.value}));d(n,i),h(n,o)}(e,o[r]),!(a.filter((function(t){return 3!==e.nodeType&&function(e,t){return Element.prototype.matches&&e.matches(t)||Element.prototype.msMatchesSelector&&e.msMatchesSelector(t)||Element.prototype.webkitMatchesSelector&&e.webkitMatchesSelector(t)}(e,t)})).length>0)){var i=y(e);if(i&&i!==y(o[r])&&(o[r].textContent=i),o[r].childNodes.length>0&&e.childNodes.length<1)o[r].innerHTML="";else{if(o[r].childNodes.length<1&&e.childNodes.length>0){var c=document.createDocumentFragment();return w(e,c,a),void o[r].appendChild(c)}e.childNodes.length>0&&w(e,o[r],a)}}}else o[r].parentNode.replaceChild(e.cloneNode(!0),o[r])}))},b=function(e,t){e&&e.forEach((function(e){if(e.attached.indexOf(t)>-1)return o(t.elem+" has attached nodes that it is also attached to, creating an infinite loop.");"render"in e&&e.render()}))},N=function(e){r(e.querySelectorAll("[reef-html]")).forEach((function(e){var t,n;e.innerHTML=(t=e.innerHTML,(n=document.createElement("div")).innerHTML=t,n.textContent),e.removeAttribute("reef-html")}))};s.emit=function(e,t,n){var r;if(!e||!t)return o("You did not provide an element or event name.");r=new CustomEvent(t,{bubbles:!0,detail:n}),e.dispatchEvent(r)},s.prototype.render=function(){if(this.lagoon)b(this.attached,this);else{if(!this.template)return o("No template was provided.");var t="string"===a(this.elem)?document.querySelector(this.elem):this.elem;if(!t)return o("The DOM element to render your template into was not found.");var n=i((this.store?this.store.data:this.data)||{},this.allowHTML),c="function"===a(this.template)?this.template(n,this.router?this.router.current:t,t):this.template;if(!(["string","number"].indexOf(a(c))<0)){var u=this.attached.map((function(e){return e.elem}));return w(function(t){if(e){var n=(new DOMParser).parseFromString(t,"text/html");return"head"in n&&"childNodes"in n.head&&n.head.childNodes.length>0&&r(n.head.childNodes).reverse().forEach((function(e){n.body.insertBefore(e,n.body.firstChild)})),N(n.body),n.body}var a=document.createElement("div");return a.innerHTML=t,a}(c),t,u),s.emit(t,"render",n),b(this.attached,this),t}}},s.prototype.attach=function(e){"array"===a(e)?this.attached.concat(e):this.attached.push(e)},s.prototype.detach=function(e){var t="array"===a(e)?e:[e],n=this;t.forEach((function(e){var t=n.attached.indexOf(e);t<0||n.attached.splice(t,1)}))},s.debug=function(e){n=!!e},s.clone=i,s._={trueTypeOf:a,err:o},e=function(){if(!window.DOMParser)return!1;var e=new DOMParser;try{e.parseFromString("x","text/html")}catch(e){return!1}return!0}(),module.exports=s;
