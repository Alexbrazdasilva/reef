/*! ReefRouter v8.0.0 | (c) 2021 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
"use strict";let t,e=/([:*])(\w+)/g,n=/\*/g,r="([^/]+)",o="(?:.*)",i="(?:/$|$)",u="";function a(t){return"/"+function(t){return t.replace(/^(#!)\/?/g,"")}(function(t){return t.replace(/^\/|\/$/g,"")}(t))}function c(c,l){if(!l||"array"!==t.trueTypeOf(l))return[];if("/"===c){let t=function(t){let e=t.find((function(t){return"/"===t.url}));return e?[{route:e,params:{}}]:null}(l);if(t)return t}return l.map((function(t){let l=function(t){let a=[];return{regexp:new RegExp(t.replace(e,(function(t,e,n){return a.push(n),r})).replace(n,o)+i,u),paramNames:a}}(a(t.url)),s=c.replace(/^\/+/,"/").match(l.regexp);if(s)return{route:t,params:function(t,e){return t&&0!==e.length?t.slice(1,t.length).reduce((function(t,n,r){return t[e[r]]=decodeURIComponent(n),t}),{}):{}}(s,l.paramNames)}})).filter((function(t){return t}))}function l(t,e){let n=document.createElement("a");return n.href=(e.length?a(e):"")+a(t),n}function s(e,n,r,o){let i=c(function(t,e,n){let r=a(t.pathname);return e.length?(e=a(e),r.startsWith(e)&&(r=r.slice(e.length)),r.length||(r="/"),r):r}(e=function(t,e,n){return(n&&".html"===t.pathname.slice(-5)||t.hash.startsWith("#!"))&&(t=l(t.hash.slice(2),e)),t}(e,r,o),r),n);if(!i.length)return;let u=t.clone(i[0].route,!0);return u.redirect?s(l("function"==typeof u.redirect?u.redirect(u):u.redirect,r),n,r,o):(u.params=i[0].params,u.search=function(t){let e=new URL(t).searchParams,n={};for(let[t,r]of e)void 0!==n[t]?(Array.isArray(n[t])||(n[t]=[n[t]]),n[t].push(r)):n[t]=r;return n}(e),u)}function f(t){let e=t.split("#");return e[2]?"#"+e[2]:""}function h(t,e){e&&(window.location.hash="!"+cleanURL(e)+t);let n=document.getElementById(t.slice(1));n&&(n.scrollIntoView(),document.activeElement!==n&&(n.setAttribute("tabindex","-1"),n.focus()))}function d(e,n){t.emit(window,"beforeRouteUpdated",{current:e,next:n})}function p(e,n){t.emit(window,"routeUpdated",{current:e,previous:n})}function w(t,e){if(!t||!t.title)return;let n="function"==typeof t.title?t.title(t):t.title;document.title="function"==typeof e.title?e.title(t,n):e.title}function m(t,e,n){e._components.forEach((function(t){"render"in t&&t.render()})),w(t,e),n?h(n):function(){let t=document.querySelector("h1, h2, h3, h4, h5, h6");t&&(t.hasAttribute("tabindex")||t.setAttribute("tabindex","-1"),t.focus())}()}function g(t,e){let n=s(t,e.routes,e.root,e.hash);if(n.redirect)return g(getLinkElem("function"==typeof n.redirect?n.redirect(n):n.redirect,e.root),e);if(e.hash){e.hashing=!0;let r=f(t.hash);if(n.url===e.current.url&&r.length)return void h(r,n.url)}let r=e.current;d(r,n),e.current=n;let o=a(t.getAttribute("href"));e.hash?window.location.hash="!"+o:history.pushState(n||{},n&&n.title?n.title:"",o),m(n,e,e.hash?f(t.hash):t.hash),p(n,r)}function y(t,e){if(t.metaKey||t.ctrlKey||t.shiftKey||t.defaultPrevented)return;let n=function(t,e){if("closest"in t.target)return t.target.closest("a")}(t);var r;!n||n.host!==window.location.host||n.hasAttribute("download")||"external"===n.getAttribute("rel")||n.href.includes("mailto:")||((r=n).pathname===window.location.pathname&&r.search===window.location.search&&!e.hash&&n.hash.length||(t.preventDefault(),g(n,e)))}function v(t){return function(e){!function(t,e){if(t.state){let n=e.current;d(n,t.state),e.current=t.state,m(e.current,e),p(t.state,n)}else history.replaceState(e.current,document.title,window.location.href)}(e,t)}}function b(t){return function(e){!function(t,e){if(e.hashing)return void(e.hashing=!1);let n=l(window.location.hash.slice(2),e.root),r=(n.getAttribute("href"),s(n,e.routes,e.root,e.hash)),o=e.current;d(o,r),e.current=r,m(r,e),p(r,o)}(0,t)}}function R(e){if(!t||!t.err)throw new Error("Reef not found. Use ReefRouter.install(Reef) to define your global Reef library.");if(!e||!e.routes||"array"!==t.trueTypeOf(e.routes)||!e.routes.length)return t.err("Please provide an array of routes.");let n=this,r=e.routes,o=e.root?e.root:"",i=e.title?e.title:"{{title}}",u=[],a=e.useHash||"file:"===window.location.protocol,c=s(window.location,r,o,a);var l;n._hashing=!1,Object.defineProperties(n,{routes:{value:t.clone(r,!0)},root:{value:o},title:{value:i},hash:{value:a},current:{get:function(){return t.clone(c,!0)},set:function(t){return c=t,!0}},_routes:{set:function(t){return r=t,!0}},_components:{get:function(){return u}}}),w(c,n),document.addEventListener("click",(l=n,function(t){y(t,l)})),a?window.addEventListener("hashchange",b(n)):(history.replaceState(c,document.title,window.location.href),window.addEventListener("popstate",v(n)))}R.prototype.addRoutes=function(e){let n=t.trueTypeOf(e);if(!["array","object"].includes(n))return t.err("Please provide a valid route or routes.");"object"===n?this.routes.push(e):this.routes.push.apply(this.routes,e)},R.prototype.addComponent=function(t){this._components.push(t)},R.prototype.navigate=function(t){g(l(t,this.root),this)},R.prototype.updateTitle=function(){w(this.current,this)},R.install=function(e){!function(e){t=e}(e)},"undefined"!=typeof window&&window.Reef&&R.install(window.Reef),module.exports=R;
